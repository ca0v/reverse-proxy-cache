<!DOCTYPE html>
<html>
  <head>
    <textarea id="logarea"></textarea>
  </head>
  <style>
    body {
      background: black;
      color: white;
    }
    #logarea {
      position: absolute;
      bottom: 0;
      right: 0;
      height: 50%;
      width: 50%;
      max-width: 40em;
      max-height: 40em;
      overflow: hidden;
      color: rgb(20, 200, 20);
      border: 1em white;
      border-style: ridge;
      padding: 1em;
      margin: 1em;
    }
  </style>
  <body>
    <script type="module">
      async function ping(body = "") {
        const method = !!body ? "POST" : "GET";
        const info = {
          method: method,
          credentials: "include",
          mode: "cors",
        };
        if (body) info.body = body;
        try {
          const response = await fetch("http://127.0.0.1:3002/mock/echo", info);
          const bodyText = await response.text();
          log(`${method}: ${bodyText}`);
        } catch (ex) {
          log(ex);
        }
      }

      function log(message) {
        console.log(message);
        const logArea = document.getElementById("logarea");
        const now = new Date().toLocaleTimeString();
        logArea.value = `${now}: ${message}\n${logArea.value}`;
      }

      async function get(url) {
        try {
          const response = await fetch(url, {
            method: "GET",
            mode: "cors",
            credentials: "omit",
          });
          const bodyText = await response.json();
          log(`${url}:\n${JSON.stringify(bodyText, null, " ")}`);
        } catch (ex) {
          log(ex);
        }
      }

      setInterval(
        () =>
          get(
            "http://localhost:3002/mock/ips/11.2/nextgen/api/endpoints/agencymaps/rmb-maplet-mixin"
          ),
        10000
      );
      setInterval(() => ping("test1"), 1000);
      setInterval(() => ping(), 10000);
    </script>
  </body>
</html>
